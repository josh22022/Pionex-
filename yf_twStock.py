import yfinance as yf  #導入yahoo finance
import talib as ta     #導入talib
import pandas as pd    #導入andas

#台股代碼
code=['1101','1102','1103','1104','1108','1109','1110','1201','1203','1210','1213','1215','1216','1217','1218','1219','1220','1225','1227','1229','1231','1232','1233','1234','1235','1236','1256','1301','1303','1304','1305','1307','1308','1309','1310','1312','1313','1314','1315','1316','1319','1321','1323','1324','1325','1326','1337','1338','1339','1340','1341','1342','1402','1409','1410','1413','1414','1416','1417','1418','1419','1423','1432','1434','1435','1436','1437','1438','1439','1440','1441','1442','1443','1444','1445','1446','1447','1449','1451','1452','1453','1454','1455','1456','1457','1459','1460','1463','1464','1465','1466','1467','1468','1470','1471','1472','1473','1474','1475','1476','1477','1503','1504','1506','1512','1513','1514','1515','1516','1517','1519','1521','1522','1524','1525','1526','1527','1528','1529','1530','1531','1532','1533','1535','1536','1537','1538','1539','1540','1541','1558','1560','1568','1582','1583','1587','1589','1590','1597','1598','1603','1604','1605','1608','1609','1611','1612','1614','1615','1616','1617','1618','1626','1701','1702','1707','1708','1709','1710','1711','1712','1713','1714','1717','1718','1720','1721','1722','1723','1725','1726','1727','1730','1731','1732','1733','1734','1735','1736','1737','1752','1760','1762','1773','1776','1783','1786','1789','1795','1802','1805','1806','1808','1809','1810','1817','1903','1904','1905','1906','1907','1909','2002','2006','2007','2008','2009','2010','2012','2013','2014','2015','2017','2020','2022','2023','2024','2025','2027','2028','2029','2030','2031','2032','2033','2034','2038','2049','2059','2062','2069','2101','2102','2103','2104','2105','2106','2107','2108','2109','2114','2115','2201','2204','2206','2207','2208','2211','2227','2228','2231','2233','2236','2239','2241','2243','2247','2250','2301','2302','2303','2305','2308','2312','2313','2314','2316','2317','2321','2323','2324','2327','2328','2329','2330','2331','2332','2337','2338','2340','2342','2344','2345','2347','2348','2349','2351','2352','2353','2354','2355','2356','2357','2358','2359','2360','2362','2363','2364','2365','2367','2368','2369','2371','2373','2374','2375','2376','2377','2379','2380','2382','2383','2385','2387','2388','2390','2392','2393','2395','2397','2399','2401','2402','2404','2405','2406','2408','2409','2412','2413','2414','2415','2417','2419','2420','2421','2423','2424','2425','2426','2427','2428','2429','2430','2431','2433','2434','2436','2438','2439','2440','2441','2442','2443','2444','2449','2450','2451','2453','2454','2455','2457','2458','2459','2460','2461','2462','2464','2465','2466','2467','2468','2471','2472','2474','2476','2477','2478','2480','2481','2482','2483','2484','2485','2486','2488','2489','2491','2492','2493','2495','2496','2497','2498','2501','2504','2505','2506','2509','2511','2514','2515','2516','2520','2524','2527','2528','2530','2534','2535','2536','2537','2538','2539','2540','2542','2543','2545','2546','2547','2548','2597','2601','2603','2605','2606','2607','2608','2609','2610','2611','2612','2613','2614','2615','2616','2617','2618','2630','2633','2634','2636','2637','2642','2701','2702','2704','2705','2706','2707','2712','2722','2723','2727','2731','2739','2748','2753','2801','2809','2812','2816','2820','2832','2834','2836','2838','2845','2849','2850','2851','2852','2855','2867','2880','2881','2882','2883','2884','2885','2886','2887','2888','2889','2890','2891','2892','2897','2901','2903','2904','2905','2906','2908','2910','2911','2912','2913','2915','2923','2929','2939','2945','3002','3003','3004','3005','3006','3008','3010','3011','3013','3014','3015','3016','3017','3018','3019','3021','3022','3023','3024','3025','3026','3027','3028','3029','3030','3031','3032','3033','3034','3035','3036','3037','3038','3040','3041','3042','3043','3044','3045','3046','3047','3048','3049','3050','3051','3052','3054','3055','3056','3057','3058','3059','3060','3062','3090','3092','3094','3130','3138','3149','3164','3167','3189','3209','3229','3231','3257','3266','3296','3305','3308','3311','3312','3321','3338','3346','3356','3376','3380','3383','3406','3413','3416','3419','3432','3437','3443','3450','3454','3481','3494','3501','3504','3515','3518','3528','3530','3532','3533','3535','3536','3543','3545','3550','3557','3563','3576','3583','3588','3591','3592','3593','3596','3605','3607','3617','3622','3645','3653','3661','3665','3669','3673','3679','3682','3686','3694','3701','3702','3703','3704','3705','3706','3708','3711','3712','3714','3715','4104','4106','4108','4119','4133','4137','4142','4148','4155','4164','4190','4306','4414','4426','4438','4439','4440','4526','4532','4536','4540','4545','4551','4552','4555','4557','4560','4562','4564','4566','4571','4572','4576','4581','4583','4720','4722','4737','4739','4746','4755','4763','4764','4766','4770','4807','4904','4906','4912','4915','4916','4919','4927','4930','4934','4935','4938','4942','4943','4952','4956','4958','4960','4961','4967','4968','4976','4977','4989','4994','4999','5007','5203','5215','5222','5225','5234','5243','5244','5258','5269','5283','5284','5285','5288','5306','5388','5434','5469','5471','5484','5515','5519','5521','5522','5525','5531','5533','5534','5538','5546','5607','5608','5706','5871','5876','5880','5906','5907','6005','6024','6108','6112','6115','6116','6117','6120','6128','6133','6136','6139','6141','6142','6152','6153','6155','6164','6165','6166','6168','6176','6177','6183','6184','6189','6191','6192','6196','6197','6201','6202','6205','6206','6209','6213','6214','6215','6216','6224','6225','6226','6230','6235','6239','6243','6257','6269','6271','6277','6278','6281','6282','6283','6285','6288','6289','6405','6409','6412','6414','6415','6416','6426','6431','6438','6442','6443','6449','6451','6456','6464','6477','6491','6504','6505','6515','6525','6531','6533','6541','6550','6552','6558','6573','6579','6581','6582','6585','6591','6592','6598','6605','6625','6641','6655','6666','6668','6669','6670','6671','6672','6674','6691','6698','6706','6715','6719','6743','6754','6756','6768','6770','6776','6781','6789','6790','6792','6796','6799','6806','6807','6830','6834','8011','8016','8021','8028','8033','8039','8046','8070','8072','8081','8101','8103','8104','8105','8110','8112','8114','8131','8150','8163','8201','8210','8213','8215','8222','8249','8261','8271','8341','8367','8374','8404','8411','8422','8429','8438','8442','8443','8454','8462','8463','8464','8466','8467','8473','8478','8480','8481','8482','8488','8499','8926','8940','8996','9802','9902','9904','9905','9906','9907','9908','9910','9911','9912','9914','9917','9918','9919','9921','9924','9925','9926','9927','9928','9929','9930','9931','9933','9934','9935','9937','9938','9939','9940','9941','9942','9943','9944','9945','9946','9955','9958','0050','0051','0052','0053','0055','0056','0057','0061','006203','006204','006205','006206','006207','006208','00625K','00631L','00632R','00633L','00634R','00635U','00636','00636K','00637L','00638R','00639','00640L','00641R','00642U','00643','00643K','00645','00646','00647L','00648R','00650L','00651R','00652','00653L','00654R','00655L','00656R','00657','00657K','00660','00661','00662','00663L','00664R','00665L','00666R','00668','00668K','00669R','00670L','00671R','00673R','00674R','00675L','00676R','00678','00680L','00681R','00682U','00683L','00684R','00685L','00686R','00688L','00689R','00690','00692','00693U','00700','00701','00702','00703','00706L','00707R','00708L','00709','00710B','00711B','00712','00713','00714','00715L','00717','00728','00730','00731','00732','00733','00735','00736','00737','00738U','00739','00743','00752','00753L','00757','00762','00763U','00770','00771','00774B','00774C','00775B','00783','00830','00850','00851','00852L','00861','00865B','00875','00876','00878','00881','00882','00885','00891','00892','00893','00894','00895','00896','00897','00898','00899','00900','00901','00902','00903','00904','00905','00906','00907','00908','00909','00910','00911','00912','00913','00915','00917']

#將所有資料暫存 檔名為"df_code"
for i in range(len(code)):   
    df = yf.Ticker(code[i]+".TW").history(period="max")    #撈取歷史所有區間
    ATR = ta.ATR(df.High, df.Low, df.Close, timeperiod=14)  #ATR
    ADX = ta.ADX(df.High, df.Low, df.Close, timeperiod=14)  #ADX
    fastk, fastd = ta.STOCHRSI(df.Close, timeperiod=14, fastk_period=5, fastd_period=3, fastd_matype=0)  #StochRSI
    EMA = ta.EMA(df.Close, timeperiod=30)  #EMA
    df = pd.concat([df,ATR,ADX,EMA,fastk,fastd],axis=1)   #合併df
    df.columns = ['Open', 'High', 'Low', 'Close', 'Volume', 'Dividends', 'Stock Splits','ATR', 'ADX', 'EMA', 'fastk', 'fastd']  #給欄位名稱
    df = df.round(2)     #取到小數第2位
    globals()['df_'+code[i]] = df
    
#根據所需條件列出資料
df_code=['df_1101','df_1102','df_1103','df_1104','df_1108','df_1109','df_1110','df_1201','df_1203','df_1210','df_1213','df_1215','df_1216','df_1217','df_1218','df_1219','df_1220','df_1225','df_1227','df_1229','df_1231','df_1232','df_1233','df_1234','df_1235','df_1236','df_1256','df_1301','df_1303','df_1304','df_1305','df_1307','df_1308','df_1309','df_1310','df_1312','df_1313','df_1314','df_1315','df_1316','df_1319','df_1321','df_1323','df_1324','df_1325','df_1326','df_1337','df_1338','df_1339','df_1340','df_1341','df_1342','df_1402','df_1409','df_1410','df_1413','df_1414','df_1416','df_1417','df_1418','df_1419','df_1423','df_1432','df_1434','df_1435','df_1436','df_1437','df_1438','df_1439','df_1440','df_1441','df_1442','df_1443','df_1444','df_1445','df_1446','df_1447','df_1449','df_1451','df_1452','df_1453','df_1454','df_1455','df_1456','df_1457','df_1459','df_1460','df_1463','df_1464','df_1465','df_1466','df_1467','df_1468','df_1470','df_1471','df_1472','df_1473','df_1474','df_1475','df_1476','df_1477','df_1503','df_1504','df_1506','df_1512','df_1513','df_1514','df_1515','df_1516','df_1517','df_1519','df_1521','df_1522','df_1524','df_1525','df_1526','df_1527','df_1528','df_1529','df_1530','df_1531','df_1532','df_1533','df_1535','df_1536','df_1537','df_1538','df_1539','df_1540','df_1541','df_1558','df_1560','df_1568','df_1582','df_1583','df_1587','df_1589','df_1590','df_1597','df_1598','df_1603','df_1604','df_1605','df_1608','df_1609','df_1611','df_1612','df_1614','df_1615','df_1616','df_1617','df_1618','df_1626','df_1701','df_1702','df_1707','df_1708','df_1709','df_1710','df_1711','df_1712','df_1713','df_1714','df_1717','df_1718','df_1720','df_1721','df_1722','df_1723','df_1725','df_1726','df_1727','df_1730','df_1731','df_1732','df_1733','df_1734','df_1735','df_1736','df_1737','df_1752','df_1760','df_1762','df_1773','df_1776','df_1783','df_1786','df_1789','df_1795','df_1802','df_1805','df_1806','df_1808','df_1809','df_1810','df_1817','df_1903','df_1904','df_1905','df_1906','df_1907','df_1909','df_2002','df_2006','df_2007','df_2008','df_2009','df_2010','df_2012','df_2013','df_2014','df_2015','df_2017','df_2020','df_2022','df_2023','df_2024','df_2025','df_2027','df_2028','df_2029','df_2030','df_2031','df_2032','df_2033','df_2034','df_2038','df_2049','df_2059','df_2062','df_2069','df_2101','df_2102','df_2103','df_2104','df_2105','df_2106','df_2107','df_2108','df_2109','df_2114','df_2115','df_2201','df_2204','df_2206','df_2207','df_2208','df_2211','df_2227','df_2228','df_2231','df_2233','df_2236','df_2239','df_2241','df_2243','df_2247','df_2250','df_2301','df_2302','df_2303','df_2305','df_2308','df_2312','df_2313','df_2314','df_2316','df_2317','df_2321','df_2323','df_2324','df_2327','df_2328','df_2329','df_2330','df_2331','df_2332','df_2337','df_2338','df_2340','df_2342','df_2344','df_2345','df_2347','df_2348','df_2349','df_2351','df_2352','df_2353','df_2354','df_2355','df_2356','df_2357','df_2358','df_2359','df_2360','df_2362','df_2363','df_2364','df_2365','df_2367','df_2368','df_2369','df_2371','df_2373','df_2374','df_2375','df_2376','df_2377','df_2379','df_2380','df_2382','df_2383','df_2385','df_2387','df_2388','df_2390','df_2392','df_2393','df_2395','df_2397','df_2399','df_2401','df_2402','df_2404','df_2405','df_2406','df_2408','df_2409','df_2412','df_2413','df_2414','df_2415','df_2417','df_2419','df_2420','df_2421','df_2423','df_2424','df_2425','df_2426','df_2427','df_2428','df_2429','df_2430','df_2431','df_2433','df_2434','df_2436','df_2438','df_2439','df_2440','df_2441','df_2442','df_2443','df_2444','df_2449','df_2450','df_2451','df_2453','df_2454','df_2455','df_2457','df_2458','df_2459','df_2460','df_2461','df_2462','df_2464','df_2465','df_2466','df_2467','df_2468','df_2471','df_2472','df_2474','df_2476','df_2477','df_2478','df_2480','df_2481','df_2482','df_2483','df_2484','df_2485','df_2486','df_2488','df_2489','df_2491','df_2492','df_2493','df_2495','df_2496','df_2497','df_2498','df_2501','df_2504','df_2505','df_2506','df_2509','df_2511','df_2514','df_2515','df_2516','df_2520','df_2524','df_2527','df_2528','df_2530','df_2534','df_2535','df_2536','df_2537','df_2538','df_2539','df_2540','df_2542','df_2543','df_2545','df_2546','df_2547','df_2548','df_2597','df_2601','df_2603','df_2605','df_2606','df_2607','df_2608','df_2609','df_2610','df_2611','df_2612','df_2613','df_2614','df_2615','df_2616','df_2617','df_2618','df_2630','df_2633','df_2634','df_2636','df_2637','df_2642','df_2701','df_2702','df_2704','df_2705','df_2706','df_2707','df_2712','df_2722','df_2723','df_2727','df_2731','df_2739','df_2748','df_2753','df_2801','df_2809','df_2812','df_2816','df_2820','df_2832','df_2834','df_2836','df_2838','df_2845','df_2849','df_2850','df_2851','df_2852','df_2855','df_2867','df_2880','df_2881','df_2882','df_2883','df_2884','df_2885','df_2886','df_2887','df_2888','df_2889','df_2890','df_2891','df_2892','df_2897','df_2901','df_2903','df_2904','df_2905','df_2906','df_2908','df_2910','df_2911','df_2912','df_2913','df_2915','df_2923','df_2929','df_2939','df_2945','df_3002','df_3003','df_3004','df_3005','df_3006','df_3008','df_3010','df_3011','df_3013','df_3014','df_3015','df_3016','df_3017','df_3018','df_3019','df_3021','df_3022','df_3023','df_3024','df_3025','df_3026','df_3027','df_3028','df_3029','df_3030','df_3031','df_3032','df_3033','df_3034','df_3035','df_3036','df_3037','df_3038','df_3040','df_3041','df_3042','df_3043','df_3044','df_3045','df_3046','df_3047','df_3048','df_3049','df_3050','df_3051','df_3052','df_3054','df_3055','df_3056','df_3057','df_3058','df_3059','df_3060','df_3062','df_3090','df_3092','df_3094','df_3130','df_3138','df_3149','df_3164','df_3167','df_3189','df_3209','df_3229','df_3231','df_3257','df_3266','df_3296','df_3305','df_3308','df_3311','df_3312','df_3321','df_3338','df_3346','df_3356','df_3376','df_3380','df_3383','df_3406','df_3413','df_3416','df_3419','df_3432','df_3437','df_3443','df_3450','df_3454','df_3481','df_3494','df_3501','df_3504','df_3515','df_3518','df_3528','df_3530','df_3532','df_3533','df_3535','df_3536','df_3543','df_3545','df_3550','df_3557','df_3563','df_3576','df_3583','df_3588','df_3591','df_3592','df_3593','df_3596','df_3605','df_3607','df_3617','df_3622','df_3645','df_3653','df_3661','df_3665','df_3669','df_3673','df_3679','df_3682','df_3686','df_3694','df_3701','df_3702','df_3703','df_3704','df_3705','df_3706','df_3708','df_3711','df_3712','df_3714','df_3715','df_4104','df_4106','df_4108','df_4119','df_4133','df_4137','df_4142','df_4148','df_4155','df_4164','df_4190','df_4306','df_4414','df_4426','df_4438','df_4439','df_4440','df_4526','df_4532','df_4536','df_4540','df_4545','df_4551','df_4552','df_4555','df_4557','df_4560','df_4562','df_4564','df_4566','df_4571','df_4572','df_4576','df_4581','df_4583','df_4720','df_4722','df_4737','df_4739','df_4746','df_4755','df_4763','df_4764','df_4766','df_4770','df_4807','df_4904','df_4906','df_4912','df_4915','df_4916','df_4919','df_4927','df_4930','df_4934','df_4935','df_4938','df_4942','df_4943','df_4952','df_4956','df_4958','df_4960','df_4961','df_4967','df_4968','df_4976','df_4977','df_4989','df_4994','df_4999','df_5007','df_5203','df_5215','df_5222','df_5225','df_5234','df_5243','df_5244','df_5258','df_5269','df_5283','df_5284','df_5285','df_5288','df_5306','df_5388','df_5434','df_5469','df_5471','df_5484','df_5515','df_5519','df_5521','df_5522','df_5525','df_5531','df_5533','df_5534','df_5538','df_5546','df_5607','df_5608','df_5706','df_5871','df_5876','df_5880','df_5906','df_5907','df_6005','df_6024','df_6108','df_6112','df_6115','df_6116','df_6117','df_6120','df_6128','df_6133','df_6136','df_6139','df_6141','df_6142','df_6152','df_6153','df_6155','df_6164','df_6165','df_6166','df_6168','df_6176','df_6177','df_6183','df_6184','df_6189','df_6191','df_6192','df_6196','df_6197','df_6201','df_6202','df_6205','df_6206','df_6209','df_6213','df_6214','df_6215','df_6216','df_6224','df_6225','df_6226','df_6230','df_6235','df_6239','df_6243','df_6257','df_6269','df_6271','df_6277','df_6278','df_6281','df_6282','df_6283','df_6285','df_6288','df_6289','df_6405','df_6409','df_6412','df_6414','df_6415','df_6416','df_6426','df_6431','df_6438','df_6442','df_6443','df_6449','df_6451','df_6456','df_6464','df_6477','df_6491','df_6504','df_6505','df_6515','df_6525','df_6531','df_6533','df_6541','df_6550','df_6552','df_6558','df_6573','df_6579','df_6581','df_6582','df_6585','df_6591','df_6592','df_6598','df_6605','df_6625','df_6641','df_6655','df_6666','df_6668','df_6669','df_6670','df_6671','df_6672','df_6674','df_6691','df_6698','df_6706','df_6715','df_6719','df_6743','df_6754','df_6756','df_6768','df_6770','df_6776','df_6781','df_6789','df_6790','df_6792','df_6796','df_6799','df_6806','df_6807','df_6830','df_6834','df_8011','df_8016','df_8021','df_8028','df_8033','df_8039','df_8046','df_8070','df_8072','df_8081','df_8101','df_8103','df_8104','df_8105','df_8110','df_8112','df_8114','df_8131','df_8150','df_8163','df_8201','df_8210','df_8213','df_8215','df_8222','df_8249','df_8261','df_8271','df_8341','df_8367','df_8374','df_8404','df_8411','df_8422','df_8429','df_8438','df_8442','df_8443','df_8454','df_8462','df_8463','df_8464','df_8466','df_8467','df_8473','df_8478','df_8480','df_8481','df_8482','df_8488','df_8499','df_8926','df_8940','df_8996','df_9802','df_9902','df_9904','df_9905','df_9906','df_9907','df_9908','df_9910','df_9911','df_9912','df_9914','df_9917','df_9918','df_9919','df_9921','df_9924','df_9925','df_9926','df_9927','df_9928','df_9929','df_9930','df_9931','df_9933','df_9934','df_9935','df_9937','df_9938','df_9939','df_9940','df_9941','df_9942','df_9943','df_9944','df_9945','df_9946','df_9955','df_9958','df_0050','df_0051','df_0052','df_0053','df_0055','df_0056','df_0057','df_0061','df_006203','df_006204','df_006205','df_006206','df_006207','df_006208','df_00625K','df_00631L','df_00632R','df_00633L','df_00634R','df_00635U','df_00636','df_00636K','df_00637L','df_00638R','df_00639','df_00640L','df_00641R','df_00642U','df_00643','df_00643K','df_00645','df_00646','df_00647L','df_00648R','df_00650L','df_00651R','df_00652','df_00653L','df_00654R','df_00655L','df_00656R','df_00657','df_00657K','df_00660','df_00661','df_00662','df_00663L','df_00664R','df_00665L','df_00666R','df_00668','df_00668K','df_00669R','df_00670L','df_00671R','df_00673R','df_00674R','df_00675L','df_00676R','df_00678','df_00680L','df_00681R','df_00682U','df_00683L','df_00684R','df_00685L','df_00686R','df_00688L','df_00689R','df_00690','df_00692','df_00693U','df_00700','df_00701','df_00702','df_00703','df_00706L','df_00707R','df_00708L','df_00709','df_00710B','df_00711B','df_00712','df_00713','df_00714','df_00715L','df_00717','df_00728','df_00730','df_00731','df_00732','df_00733','df_00735','df_00736','df_00737','df_00738U','df_00739','df_00743','df_00752','df_00753L','df_00757','df_00762','df_00763U','df_00770','df_00771','df_00774B','df_00774C','df_00775B','df_00783','df_00830','df_00850','df_00851','df_00852L','df_00861','df_00865B','df_00875','df_00876','df_00878','df_00881','df_00882','df_00885','df_00891','df_00892','df_00893','df_00894','df_00895','df_00896','df_00897','df_00898','df_00899','df_00900','df_00901','df_00902','df_00903','df_00904','df_00905','df_00906','df_00907','df_00908','df_00909','df_00910','df_00911','df_00912','df_00913','df_00915','df_00917']
for j in range(len(df_code)):
    #for i in range(len(globals()[df_code[j]])):
    if globals()[df_code[j]].iloc[-1].ADX >= 20 and globals()[df_code[j]].iloc[-1].fastk > globals()[df_code[j]].iloc[-1].fastd :       
            print(df_code[j])
                #print(globals()[df_code[j]].iloc[i].name)



